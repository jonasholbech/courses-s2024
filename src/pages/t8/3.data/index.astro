---
import SlideLayout from "../../../layouts/SlideLayout.astro";
import codeFetcher from "../../../js/codeFetcher";
import Code from "../../../components/Code.astro";
import Explainer from "../../../components/Explainer.svelte";
import CompletionTracker from "../../../components/CompletionTracker.svelte";
import AgendaSection from "../../../components/AgendaSection.astro";
import Goal from "../../../components/Goal.astro";

const snippets = await codeFetcher("t8/3.data", [
  "fetch-chain.js",
  "fetch-async.js",
  "fetch-astro.astro",
  "fetch-astro-debugger.astro",
  "foreach-map.js",
  "arrays-astro.astro",
  "arrays-astro-components.astro",
  "full-map-example.astro",
]);
---

<SlideLayout title="Astro - Data">
  <AgendaSection header="Astro - Data">
    <Goal>
      <ol>
        <li>Be able to fetch data in Astro</li>
        <li>Modify <code>.map</code></li>
      </ol>
    </Goal>

    <section>
      <h2>Agenda</h2>
      <ol>
        <li>Data fetching</li>
        <li>Mapping</li>
        <li>Coaching</li>
      </ol>
    </section>
  </AgendaSection>

  <AgendaSection header="Data Fetching">
    <section>
      <h2><code>fetch</code></h2>
      <h3>two syntaxes</h3>
    </section>
    <section>
      <h3>What we've been doing</h3>
      <Code code={snippets["fetch-chain.js"]} language="js" startFrom="1" />
    </section>
    <section>
      <h3>What we could have been doing</h3>
      <Code code={snippets["fetch-async.js"]} language="js" startFrom="1" />
    </section>
    <section>
      <h3>Comparing</h3>
      <Code code={snippets["fetch-chain.js"]} language="js" startFrom="1" />
      <Code code={snippets["fetch-async.js"]} language="js" startFrom="1" />
    </section>
    <section>
      <h3>How Astro allows / requires us to do it</h3>
      <p>(this only works in Astro, not in vanilla JS)</p>
      <Code code={snippets["fetch-astro.astro"]} language="js" startFrom="1" />
    </section>
    <section>
      <p>Let's try to get some data, and <code>console.log</code> it</p>
      <p>
        <a href="https://kea-alt-del.dk/t7/api/products"
          >https://kea-alt-del.dk/t7/api/products</a
        >
      </p>
    </section>
    <section>
      <p>Debugging</p>
      <p>
        Our <code>console.log</code> ends up in the Terminal, WTF?
      </p>
      <p class="fragment">
        <a
          href="https://docs.astro.build/en/reference/api-reference/#built-in-components"
          >https://docs.astro.build/en/reference/api-reference/#built-in-components</a
        >
      </p>
    </section>
    <section>
      <Code
        code={snippets["fetch-astro-debugger.astro"]}
        language="js"
        startFrom="1"
        lineNumbers="2|8|10-13"
      />
    </section>
  </AgendaSection>

  <AgendaSection header="Mapping">
    <section>
      <p>OK, now I got my data, now what?</p>
      <p class="fragment"><code>forEach</code> vs <code>map</code></p>
      <Code
        code={snippets["foreach-map.js"]}
        language="js"
        startFrom="1"
        lineNumbers="1|3-6|8-12"
        stretch
      />
    </section>
    <section>
      <p>
        So, with <code>forEach</code> we loop through stuff and do something
      </p>
      <p>
        With <code>map</code> we loop through stuff, and return something, creating
        a new array
      </p>
    </section>
    <section>
      <p>Example?</p>
    </section>

    <section>
      <p>Astro can render an array of elements for us</p>
      <Code code={snippets["arrays-astro.astro"]} language="js" startFrom="1" />
    </section>
    <section>
      <p>Or even components</p>
      <Code
        code={snippets["arrays-astro-components.astro"]}
        language="js"
        startFrom="1"
      />
    </section>
    <section>
      <p>So all we need is</p>
      <ol>
        <li>fetch some data</li>
        <li><code>map</code> through it and</li>
        <li><code>return</code> some HTML or a component</li>
      </ol>
    </section>
  </AgendaSection>
  <AgendaSection header="The rest of the day">
    <section>
      <h3>Coaching</h3>
    </section>
    <section>
      <p>The Astro tutorial</p>
      <p>
        <a href="https://docs.astro.build/en/tutorial/0-introduction/"
          >https://docs.astro.build/en/tutorial/0-introduction/</a
        >
      </p>
    </section>
    <!-- <section>
      <h3>Obligatorisk projektvejledning</h3>
      <p>Have you signed up?</p>
    </section> -->
  </AgendaSection>
</SlideLayout>

<!--

  <Code
        code={snippets["First.astro"]}
        language="js"
        startFrom="1"
        lineNumbers="1-2|1-5|7|9-11|13-15"
        stretch
      />
 -->
